#!/bin/sh

echo "ğŸ” Running pre-commit checks..."

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$')

if [ -z "$STAGED_FILES" ]; then
  echo "âš ï¸ No TypeScript/JavaScript files to check"
  exit 0
fi

# Format check (only staged files)
echo "ğŸ“ Checking formatting..."
echo "$STAGED_FILES" | xargs deno task format:check
if [ $? -ne 0 ]; then
  echo "âŒ Formatting check failed. Run 'deno task format' to fix."
  exit 1
fi

# Lint (only staged files)
echo "ğŸ” Running linter..."
echo "$STAGED_FILES" | xargs deno task lint
if [ $? -ne 0 ]; then
  echo "âŒ Linting failed. Fix the issues before committing."
  exit 1
fi

# Tests - run all tests (they should be fast anyway)
echo "ğŸ§ª Running tests..."
deno task test
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Fix the tests before committing."
  exit 1
fi

echo "âœ… All checks passed!"
exit 0
